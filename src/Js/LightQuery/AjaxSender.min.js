"use strict";function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _iterableToArrayLimit(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null!=_i){var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!(i&&_arr.length===i));_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i["return"]||_i["return"]()}finally{if(_d)throw _e}}return _arr}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var descriptor,i=0;i<props.length;i++)descriptor=props[i],descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}"undefined"==typeof window&&(XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest);var AjaxSender=function(){function AjaxSender(url,parameters){_classCallCheck(this,AjaxSender),this.url=url,this.xhr=new XMLHttpRequest,this._parameters={method:parameters.method||"GET",data:parameters.data||{},responseType:parameters.responseType||"json",headers:parameters.headers||{},progress:parameters.progress,load:parameters.load,error:parameters.error,uploadProgress:parameters.uploadProgress,uploadLoad:parameters.uploadLoad},this._parameters.wait||this.send()}return _createClass(AjaxSender,[{key:"_handleCallbacks",value:function _handleCallbacks(){var _this=this;this._parameters.progress&&this.xhr.addEventListener("progress",function(){Reflect.apply(_this._parameters.progress,null,[_this.xhr.response])});var promise=new Promise(function(resolve,reject){(_this._parameters.load||_this._returnPromise)&&_this.xhr.addEventListener("load",function(){200==_this.xhr.status?(resolve(_this.xhr.response),_this._parameters.load&&Reflect.apply(_this._parameters.load,null,[_this.xhr.response])):(_this._parameters.error?Reflect.apply(_this._parameters.error,null,[_this.xhr]):console.log(_this.xhr),reject(_this.xhr))})});return this.xhr.addEventListener("error",this._parameters.error?function(){Reflect.apply(_this._parameters.error,null,[_this.xhr])}:function(){console.log(_this.xhr)}),this._parameters.uploadProgress&&(this.xhr.upload?this.xhr.upload.addEventListener("progress",function(){Reflect.apply(_this._parameters.uploadProgress,null,[_this.xhr.response])}):console.log("Upload callbacks are unavailable in a NodeJS environment.")),this._parameters.uploadLoad&&(this.xhr.upload?this.xhr.upload.addEventListener("load",function(){Reflect.apply(_this._parameters.uploadLoad,null,[_this.xhr.response])}):console.log("Upload callbacks are unavailable in a NodeJS environment.")),this.xhr.upload&&this.xhr.upload.addEventListener("error",this._parameters.error?function(){Reflect.apply(_this._parameters.error,null,[_this.xhr])}:function(){console.log(_this.xhr)}),promise}},{key:"_objectToURL",value:function _objectToURL(object,prefix){var str=[];for(var p in object)if(Reflect.ownKeys(object).includes(p)){var k=prefix?prefix+"["+p+"]":p,v=object[p];str.push(null!==v&&"object"===_typeof(v)?this._objectToURL(v,k):encodeURIComponent(k)+"="+encodeURIComponent(v))}return str.join("&")}},{key:"asPromise",value:function asPromise(){return this._returnPromise=!0,this}},{key:"stop",value:function stop(){return this.xhr.abort(),this}},{key:"send",value:function send(){var _this2=this,loadPromise=this._handleCallbacks();if(this.xhr.responseType=this._parameters.responseType,"GET"==this._parameters.method){var urlObject=new URL(this.url);urlObject.search+=(urlObject.search.length&&Object.keys(this._parameters.data).length?"&":"")+this._objectToURL(this._parameters.data),this.xhr.open("GET",urlObject.href)}else this.xhr.open(this._parameters.method,this.url);return Object.entries(this._parameters.headers).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),header=_ref2[0],value=_ref2[1];return _this2.xhr.setRequestHeader(header,value)}),"GET"==this._parameters.method?this.xhr.send():"undefined"!=typeof window&&this._parameters.data instanceof FormData?(!_toConsumableArray(this._parameters.data.values()).find(function(e){return e instanceof File})&&(this._parameters.data.processData=!1,this._parameters.data.contentType=!1),this.xhr.send(this._parameters.data)):this.xhr.send(JSON.stringify(this._parameters.data)),this._returnPromise?loadPromise:this}}]),AjaxSender}();"undefined"==typeof window&&(module.exports=AjaxSender);
